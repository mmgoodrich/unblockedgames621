var nape_DebugDraw;!function(o){var p,t,n;p=o.constraint||(o.constraint={}),t=nape.geom.Vec2,n=function(){function p(){}return p.indicator=function(o,p,n,e,l){var i=t.get(Math.cos(n),Math.sin(n));o.drawFilledCircle(p.add(i.mul(e,!0),!0),2,l),i.dispose()},p.drawSpiralSpring=function(p,n,e,l,i,r,a,s){if(void 0===s&&(s=4),e>l){var _=e;e=l,l=_;var u=i;i=r,r=u}if(e!=l){for(var d=r-i,z=l-e,h=2*Math.PI*d/z,x=h<0?-h:h,c=Math.ceil(z/o.constraint.ZPP_AngleDraw.maxarc*3),f=4*s,y=c>f?c:f,b=z/y,P=1/y,m=Math.cos(e),g=Math.sin(e),w=i+0*d+.75*x*Math.sin(2*s*Math.PI*0),v=t.get(n.x+w*m,n.y+w*g),C=d+1.5*s*x*Math.PI*Math.cos(2*s*Math.PI*0),S=C*m-w*z*g,Z=C*g+w*z*m,A=t.get(0,0,!1),M=t.get(0,0,!1),T=0;T<y;){var N=T++,O=e+b,D=Math.cos(O),I=Math.sin(O),B=i+d*(N+1)*P+.75*x*Math.sin(2*s*Math.PI*(N+1)*P);A.setxy(n.x+B*D,n.y+B*I);var k=d+1.5*s*x*Math.PI*Math.cos(2*s*Math.PI*(N+1)*P),L=k*D-B*z*I,E=k*I+B*z*D,F=S*E-Z*L;if(F*F<nape.Config.epsilon||S*L+Z*E<=0||S*L+Z*E>.999)p.drawLine(v,A,a);else{var V=((A.x-v.x)*E+(v.y-A.y)*L)/F;V<=0?p.drawLine(v,A,a):(M.x=v.x+S*V,M.y=v.y+Z*V,p.drawCurve(v,M,A,a))}e=O,m=D,g=I,S=L,Z=E,v.set(A)}v.dispose(),A.dispose(),M.dispose()}},p.drawSpiral=function(p,n,e,l,i,r,a){if(e>l){var s=e;e=l,l=s;var _=i;i=r,r=_}if(e!=l){for(var u=r-i,d=l-e,z=Math.ceil(d/o.constraint.ZPP_AngleDraw.maxarc),h=u/z,x=d/z,c=Math.cos(e),f=Math.sin(e),y=t.get(n.x+i*c,n.y+i*f),b=u*c-i*d*f,P=u*f+i*d*c,m=t.get(0,0,!1),g=t.get(0,0,!1),w=0;w<z;){++w;var v=i+h,C=e+x,S=Math.cos(C),Z=Math.sin(C);m.setxy(n.x+v*S,n.y+v*Z);var A=u*S-v*d*Z,M=u*Z+v*d*S,T=b*M-P*A;if(T*T<nape.Config.epsilon)p.drawLine(y,m,a);else{var N=((m.x-y.x)*M+(y.y-m.y)*A)/T;N<=0?p.drawLine(y,m,a):(g.x=y.x+b*N,g.y=y.y+P*N,p.drawCurve(y,g,m,a))}i=v,e=C,c=S,f=Z,b=A,P=M,y.set(m)}y.dispose(),m.dispose(),g.dispose()}},p.maxarc=Math.PI/4,p}(),p.ZPP_AngleDraw=n}(zpp_nape||(zpp_nape={})),function(o){var p=zpp_nape.constraint.ZPP_AngleJoint,t=zpp_nape.constraint.ZPP_PivotJoint,n=zpp_nape.constraint.ZPP_AngleDraw,e=zpp_nape.constraint.ZPP_DistanceJoint,l=zpp_nape.constraint.ZPP_LineJoint,i=zpp_nape.constraint.ZPP_PulleyJoint,r=zpp_nape.constraint.ZPP_UserConstraint,a=zpp_nape.constraint.ZPP_WeldJoint;p.prototype.draw=function(o){var p=this.outer_zn,t=5/Math.PI/2;if(p.body1!=p.body1.space.world){var e=p.ratio*p.body2.rotation-this.jointMin,l=p.ratio*p.body2.rotation-this.jointMax;if(e>l){var i=e;e=l,l=i}if(p.body1.rotation>e){var r=p.body1.rotation,a=r<l?r:l;n.drawSpiral(o,p.body1.position,e,a,10+(e-e)*t,10+(a-e)*t,16776960)}else!this.stiff&&p.body1.rotation<e&&n.drawSpiralSpring(o,p.body1.position,p.body1.rotation,e,10+(p.body1.rotation-e)*t,10+(e-e)*t,16776960);if(p.body1.rotation<l){var s=p.body1.rotation,_=s>e?s:e;n.drawSpiral(o,p.body1.position,_,l,10+(_-e)*t,10+(l-e)*t,65535)}else!this.stiff&&p.body1.rotation>l&&n.drawSpiralSpring(o,p.body1.position,p.body1.rotation,l,10+(p.body1.rotation-e)*t,10+(l-e)*t,65535);n.indicator(o,p.body1.position,p.body1.rotation,10+(p.body1.rotation-e)*t,255)}if(p.body2!=p.body2.space.world){var u=(this.jointMin+p.body1.rotation)/p.ratio,d=(this.jointMax+p.body1.rotation)/p.ratio;if(u>d){var z=u;u=d,d=z}if(p.body2.rotation>u){var h=p.body2.rotation,x=h<d?h:d;n.drawSpiral(o,p.body2.position,u,x,10+(u-u)*t,10+(x-u)*t,16776960)}else!this.stiff&&p.body2.rotation<u&&n.drawSpiralSpring(o,p.body2.position,p.body2.rotation,u,10+(p.body2.rotation-u)*t,10+(u-u)*t,16776960);if(p.body2.rotation<d){var c=p.body2.rotation,f=c>u?c:u;n.drawSpiral(o,p.body2.position,f,d,10+(f-u)*t,10+(d-u)*t,65535)}else!this.stiff&&p.body2.rotation>d&&n.drawSpiralSpring(o,p.body2.position,p.body2.rotation,d,10+(p.body2.rotation-u)*t,10+(d-u)*t,65535);n.indicator(o,p.body2.position,p.body2.rotation,10+(p.body2.rotation-u)*t,16711680)}},t.prototype.draw=function(o){var p=this.outer_zn,t=p.anchor1,n=p.body1.localPointToWorld(t),e=p.anchor2,l=p.body2.localPointToWorld(e);if(!this.stiff){var i=l.sub(n);0!=i.length&&o.drawSpring(n,l,16711935),i.dispose()}o.drawFilledCircle(n,2,255),o.drawFilledCircle(l,2,16711680),n.dispose(),l.dispose()},e.prototype.draw=function(o){var p=this.outer_zn,t=p.anchor1,n=p.body1.localPointToWorld(t),e=p.anchor2,l=p.body2.localPointToWorld(e),i=l.sub(n),r=i.length;if(0!=r){i.muleq(1/r);var a=n.add(l).muleq(.5),s=a.sub(i.mul(.5*this.jointMin,!0)),_=a.add(i.mul(.5*this.jointMin,!0)),u=a.sub(i.mul(.5*this.jointMax,!0)),d=a.add(i.mul(.5*this.jointMax,!0));o.drawLine(s,_,16776960),o.drawLine(u,s,65535),o.drawLine(d,_,65535),this.stiff||(r>this.jointMax?(o.drawSpring(u,n,65535),o.drawSpring(d,l,65535)):r<this.jointMin&&(o.drawSpring(s,n,16776960),o.drawSpring(_,l,16776960))),a.dispose(),s.dispose(),_.dispose(),u.dispose(),d.dispose()}o.drawFilledCircle(n,2,255),o.drawFilledCircle(l,2,16711680),n.dispose(),l.dispose(),i.dispose()},l.prototype.draw=function(o){var p=this.outer_zn,t=p.anchor1,n=p.body1.localPointToWorld(t),e=p.anchor2,l=p.body2.localPointToWorld(e),i=p.direction,r=p.body1.localVectorToWorld(i);r.muleq(1/r.length);var a=p.jointMin,s=p.jointMax;a<=zpp_nape.ZPP_Const.NEGINF()&&(a=-1e3),s>=zpp_nape.ZPP_Const.POSINF()&&(s=1e3);var _=l.sub(n),u=_.dot(r);_.dispose();var d=n.add(r.mul(a,!0)),z=n.add(r.mul(s,!0));if(u>a){var h=s;o.drawLine(d,n.add(r.mul(u<h?u:h,!0),!0),16776960)}if(u<s){var x=a;o.drawLine(n.add(r.mul(u>x?u:x,!0),!0),z,65535)}if(!this.stiff){var c=u<this.jointMin?d.copy():u>this.jointMax?z.copy():n.add(r.mul(u,!0));o.drawSpring(c,l,16711935),c.dispose()}o.drawFilledCircle(n,2,255),o.drawFilledCircle(l,2,16711680),n.dispose(),l.dispose(),d.dispose(),z.dispose()},i.prototype.draw=function(o){var p=this.outer_zn,t=p.anchor1,n=p.body1.localPointToWorld(t),e=p.anchor2,l=p.body2.localPointToWorld(e),i=p.anchor3,r=p.body3.localPointToWorld(i),a=p.anchor4,s=p.body4.localPointToWorld(a),_=l.sub(n),u=s.sub(r),d=_.length,z=u.length;this.drawLink(o,n,l,_,d,z*this.ratio,1,16776960,65535),this.drawLink(o,r,s,u,z,d,1/this.ratio,65535,16711935),o.drawFilledCircle(n,2,255),o.drawFilledCircle(l,2,16711680),o.drawFilledCircle(r,2,65280),o.drawFilledCircle(s,2,16711935),n.dispose(),l.dispose(),r.dispose(),s.dispose(),_.dispose(),u.dispose()},i.prototype.drawLink=function(o,p,t,n,e,l,i,r,a){if(0!=e){n.muleq(1/e);var s=p.add(t).muleq(.5),_=(this.jointMin-l)*i;_<0&&(_=0);var u=(this.jointMax-l)*i;u<0&&(u=0);var d=s.sub(n.mul(.5*_,!0)),z=s.add(n.mul(.5*_,!0)),h=s.sub(n.mul(.5*u,!0)),x=s.add(n.mul(.5*u,!0));o.drawLine(d,z,r),o.drawLine(h,d,a),o.drawLine(x,z,a),this.stiff||(e>u?(o.drawSpring(h,p,a),o.drawSpring(x,t,a)):e<_&&(o.drawSpring(d,p,r),o.drawSpring(z,t,r))),s.dispose(),d.dispose(),z.dispose(),h.dispose(),x.dispose()}},r.prototype.draw=function(o){this.outer_zn.__draw(o)},a.prototype.draw=function(o){var p=this.outer_zn,t=p.anchor1,e=p.body1.localPointToWorld(t),l=p.anchor2,i=p.body2.localPointToWorld(l);if(!this.stiff){var r=i.sub(e);0!=r.length&&o.drawSpring(e,i,16711935),r.dispose();var a=5/Math.PI/2;if(p.body1!=p.body1.space.world){var s=p.body2.rotation-p.phase,_=p.body1.rotation;if(_>s){var u=_;_=s,s=u}n.drawSpiralSpring(o,p.body1.position,_,s,10+(_-_)*a,10+(s-_)*a,16711808),n.indicator(o,p.body1.position,p.body1.rotation,10+(p.body1.rotation-_)*a,16711808)}if(p.body2!=p.body2.space.world){var d=p.phase+p.body1.rotation,z=p.body2.rotation;if(z>d){var h=z;z=d,d=h}n.drawSpiralSpring(o,p.body2.position,z,d,10+(z-z)*a,10+(d-z)*a,8388863),n.indicator(o,p.body2.position,p.body2.rotation,10+(p.body2.rotation-z)*a,8388863)}}o.drawFilledCircle(e,2,255),o.drawFilledCircle(i,2,16711680),e.dispose(),i.dispose()}}(nape_DebugDraw||(nape_DebugDraw={})),function(o){var p,t,n,e,l,i,r,a,s,_,u,d,z,h,x,c,f,y,b,P,m,g,w,v,C,S,Z,A,M,T,N,O,D,I,B,k,L,E,F,V,W,R,j,K,G,H,q,J,U,Q,X,Y,$,oo,po,to,no,eo,lo,io,ro,ao,so,_o,uo,zo,ho,xo,co,fo,yo,bo,Po,mo,go,wo,vo,Co,So,Zo,Ao,Mo,To,No,Oo,Do,Io,Bo,ko,Lo,Eo,Fo,Vo,Wo,Ro,jo,Ko,Go,Ho,qo,Jo,Uo,Qo,Xo,Yo;p=o.util||(o.util={}),t=o.constraint.ConstraintIterator,n=o.phys.InteractorIterator,e=o.phys.BodyIterator,l=o.phys.CompoundIterator,i=o.callbacks.ListenerIterator,r=o.callbacks.CbTypeIterator,a=o.geom.ConvexResultIterator,s=o.geom.GeomPolyIterator,_=o.geom.RayResultIterator,u=o.geom.Vec2Iterator,d=o.shape.ShapeIterator,z=o.shape.EdgeIterator,h=o.dynamics.ContactIterator,x=o.dynamics.ArbiterIterator,c=o.dynamics.InteractionGroupIterator,f=zpp_nape.util.ZNPNode_ZPP_CbType,y=zpp_nape.util.ZNPNode_ZPP_CallbackSet,b=zpp_nape.phys.ZPP_Material,P=zpp_nape.util.ZNPNode_ZPP_Shape,m=zpp_nape.phys.ZPP_FluidProperties,g=zpp_nape.util.ZNPNode_ZPP_Body,w=zpp_nape.util.ZNPNode_ZPP_Constraint,v=zpp_nape.util.ZNPNode_ZPP_Compound,C=zpp_nape.util.ZNPNode_ZPP_Arbiter,S=zpp_nape.util.ZPP_Set_ZPP_Body,Z=zpp_nape.callbacks.ZPP_CbSetPair,A=zpp_nape.util.ZNPNode_ZPP_InteractionListener,M=zpp_nape.util.ZNPNode_ZPP_CbSet,T=zpp_nape.util.ZNPNode_ZPP_Interactor,N=zpp_nape.util.ZNPNode_ZPP_BodyListener,O=zpp_nape.callbacks.ZPP_Callback,D=zpp_nape.callbacks.ZPP_CbSet,I=zpp_nape.util.ZNPNode_ZPP_CbSetPair,B=zpp_nape.util.ZNPNode_ZPP_ConstraintListener,k=zpp_nape.geom.ZPP_GeomVertexIterator,L=zpp_nape.geom.ZPP_GeomVert,E=zpp_nape.geom.ZPP_Mat23,F=zpp_nape.util.ZPP_Set_ZPP_CbSetPair,V=zpp_nape.geom.ZPP_CutVert,W=zpp_nape.geom.ZPP_CutInt,R=zpp_nape.util.ZNPNode_ZPP_CutInt,j=zpp_nape.util.ZNPNode_ZPP_CutVert,K=zpp_nape.geom.ZPP_Vec2,G=zpp_nape.util.ZNPNode_ZPP_PartitionVertex,H=zpp_nape.geom.ZPP_PartitionVertex,q=zpp_nape.util.ZPP_Set_ZPP_PartitionVertex,J=zpp_nape.geom.ZPP_SimplifyV,U=zpp_nape.geom.ZPP_SimplifyP,Q=zpp_nape.geom.ZPP_PartitionedPoly,X=zpp_nape.util.ZNPNode_ZPP_SimplifyP,Y=zpp_nape.util.ZNPNode_ZPP_PartitionedPoly,$=zpp_nape.util.ZPP_Set_ZPP_PartitionPair,oo=zpp_nape.util.ZNPNode_ZPP_GeomVert,po=zpp_nape.geom.ZPP_AABB,to=zpp_nape.util.ZPP_Set_ZPP_SimpleVert,no=zpp_nape.geom.ZPP_PartitionPair,eo=zpp_nape.geom.ZPP_SimpleVert,lo=zpp_nape.geom.ZPP_SimpleSeg,io=zpp_nape.util.ZPP_Set_ZPP_SimpleSeg,ro=zpp_nape.util.ZPP_Set_ZPP_SimpleEvent,ao=zpp_nape.geom.ZPP_SimpleEvent,so=zpp_nape.util.Hashable2_Boolfalse,_o=zpp_nape.geom.ZPP_ToiEvent,uo=zpp_nape.util.ZNPNode_ZPP_SimpleVert,zo=zpp_nape.util.ZNPNode_ZPP_SimpleEvent,ho=zpp_nape.geom.ZPP_MarchSpan,xo=zpp_nape.geom.ZPP_MarchPair,co=zpp_nape.util.ZNPNode_ZPP_Vec2,fo=zpp_nape.shape.ZPP_Edge,yo=zpp_nape.util.ZNPNode_ZPP_AABBPair,bo=zpp_nape.util.ZNPNode_ZPP_Edge,Po=zpp_nape.space.ZPP_SweepData,mo=zpp_nape.space.ZPP_AABBNode,go=zpp_nape.space.ZPP_AABBPair,wo=zpp_nape.util.ZNPNode_ZPP_AABBNode,vo=zpp_nape.dynamics.ZPP_Contact,Co=zpp_nape.util.ZNPNode_ZPP_Component,So=zpp_nape.space.ZPP_Island,Zo=zpp_nape.space.ZPP_Component,Ao=zpp_nape.space.ZPP_CallbackSet,Mo=zpp_nape.util.ZPP_Set_ZPP_CbSet,To=zpp_nape.util.ZNPNode_ZPP_FluidArbiter,No=zpp_nape.dynamics.ZPP_ColArbiter,Oo=zpp_nape.util.ZNPNode_ZPP_SensorArbiter,Do=zpp_nape.util.ZNPNode_ZPP_Listener,Io=zpp_nape.util.ZNPNode_ZPP_ColArbiter,Bo=zpp_nape.util.ZNPNode_ZPP_InteractionGroup,ko=zpp_nape.util.ZNPNode_ZPP_ToiEvent,Lo=zpp_nape.dynamics.ZPP_InteractionFilter,Eo=zpp_nape.util.ZNPNode_ConvexResult,Fo=zpp_nape.util.ZNPNode_ZPP_GeomPoly,Vo=zpp_nape.util.ZNPNode_RayResult,Wo=zpp_nape.util.ZPP_PubPool,Ro=zpp_nape.dynamics.ZPP_SensorArbiter,jo=zpp_nape.dynamics.ZPP_FluidArbiter,Ko=o.space.Space,Go=o.phys.Body,Ho=o.geom.Vec2,qo=o.geom.Vec2List,Jo=o.geom.GeomPoly,Uo=o.phys.Compound,Qo=o.shape.Shape,Xo=o.constraint.Constraint,Yo=function(){function o(){this.zpp_inner=null,this.drawCollisionArbiters=!1,this.drawFluidArbiters=!1,this.drawSensorArbiters=!1,this.drawBodies=!1,this.drawBodyDetail=!1,this.drawShapeDetail=!1,this.drawShapeAngleIndicators=!1,this.drawConstraints=!1,this.cullingEnabled=!1,this.drawCollisionArbiters=!1,this.drawFluidArbiters=!1,this.drawSensorArbiters=!1,this.drawBodies=!0,this.drawShapeAngleIndicators=!0,this.drawBodyDetail=!1,this.drawShapeDetail=!1,this.drawConstraints=!1,this.cullingEnabled=!1,this.colour=null}return o.version=function(){return"Nape 2.0.19"},o.clearObjectPools=function(){for(;null!=t.zpp_pool;){var o=t.zpp_pool.zpp_next;t.zpp_pool.zpp_next=null,t.zpp_pool=o}for(;null!=n.zpp_pool;)o=n.zpp_pool.zpp_next,n.zpp_pool.zpp_next=null,n.zpp_pool=o;for(;null!=e.zpp_pool;)o=e.zpp_pool.zpp_next,e.zpp_pool.zpp_next=null,e.zpp_pool=o;for(;null!=l.zpp_pool;)o=l.zpp_pool.zpp_next,l.zpp_pool.zpp_next=null,l.zpp_pool=o;for(;null!=i.zpp_pool;)o=i.zpp_pool.zpp_next,i.zpp_pool.zpp_next=null,i.zpp_pool=o;for(;null!=r.zpp_pool;)o=r.zpp_pool.zpp_next,r.zpp_pool.zpp_next=null,r.zpp_pool=o;for(;null!=a.zpp_pool;)o=a.zpp_pool.zpp_next,a.zpp_pool.zpp_next=null,a.zpp_pool=o;for(;null!=s.zpp_pool;)o=s.zpp_pool.zpp_next,s.zpp_pool.zpp_next=null,s.zpp_pool=o;for(;null!=u.zpp_pool;)o=u.zpp_pool.zpp_next,u.zpp_pool.zpp_next=null,u.zpp_pool=o;for(;null!=_.zpp_pool;)o=_.zpp_pool.zpp_next,_.zpp_pool.zpp_next=null,_.zpp_pool=o;for(;null!=d.zpp_pool;)o=d.zpp_pool.zpp_next,d.zpp_pool.zpp_next=null,d.zpp_pool=o;for(;null!=z.zpp_pool;)o=z.zpp_pool.zpp_next,z.zpp_pool.zpp_next=null,z.zpp_pool=o;for(;null!=h.zpp_pool;)o=h.zpp_pool.zpp_next,h.zpp_pool.zpp_next=null,h.zpp_pool=o;for(;null!=x.zpp_pool;)o=x.zpp_pool.zpp_next,x.zpp_pool.zpp_next=null,x.zpp_pool=o;for(;null!=c.zpp_pool;)o=c.zpp_pool.zpp_next,c.zpp_pool.zpp_next=null,c.zpp_pool=o;for(;null!=f.zpp_pool;)o=f.zpp_pool.next,f.zpp_pool.next=null,f.zpp_pool=o;for(;null!=y.zpp_pool;)o=y.zpp_pool.next,y.zpp_pool.next=null,y.zpp_pool=o;for(;null!=b.zpp_pool;)o=b.zpp_pool.next,b.zpp_pool.next=null,b.zpp_pool=o;for(;null!=P.zpp_pool;)o=P.zpp_pool.next,P.zpp_pool.next=null,P.zpp_pool=o;for(;null!=m.zpp_pool;)o=m.zpp_pool.next,m.zpp_pool.next=null,m.zpp_pool=o;for(;null!=g.zpp_pool;)o=g.zpp_pool.next,g.zpp_pool.next=null,g.zpp_pool=o;for(;null!=w.zpp_pool;)o=w.zpp_pool.next,w.zpp_pool.next=null,w.zpp_pool=o;for(;null!=v.zpp_pool;)o=v.zpp_pool.next,v.zpp_pool.next=null,v.zpp_pool=o;for(;null!=C.zpp_pool;)o=C.zpp_pool.next,C.zpp_pool.next=null,C.zpp_pool=o;for(;null!=S.zpp_pool;)o=S.zpp_pool.next,S.zpp_pool.next=null,S.zpp_pool=o;for(;null!=Z.zpp_pool;)o=Z.zpp_pool.next,Z.zpp_pool.next=null,Z.zpp_pool=o;for(;null!=A.zpp_pool;)o=A.zpp_pool.next,A.zpp_pool.next=null,A.zpp_pool=o;for(;null!=M.zpp_pool;)o=M.zpp_pool.next,M.zpp_pool.next=null,M.zpp_pool=o;for(;null!=T.zpp_pool;)o=T.zpp_pool.next,T.zpp_pool.next=null,T.zpp_pool=o;for(;null!=N.zpp_pool;)o=N.zpp_pool.next,N.zpp_pool.next=null,N.zpp_pool=o;for(;null!=O.zpp_pool;)o=O.zpp_pool.next,O.zpp_pool.next=null,O.zpp_pool=o;for(;null!=D.zpp_pool;)o=D.zpp_pool.next,D.zpp_pool.next=null,D.zpp_pool=o;for(;null!=I.zpp_pool;)o=I.zpp_pool.next,I.zpp_pool.next=null,I.zpp_pool=o;for(;null!=B.zpp_pool;)o=B.zpp_pool.next,B.zpp_pool.next=null,B.zpp_pool=o;for(;null!=L.zpp_pool;)o=L.zpp_pool.next,L.zpp_pool.next=null,L.zpp_pool=o;for(;null!=k.zpp_pool;)o=k.zpp_pool.next,k.zpp_pool.next=null,k.zpp_pool=o;for(;null!=E.zpp_pool;)o=E.zpp_pool.next,E.zpp_pool.next=null,E.zpp_pool=o;for(;null!=F.zpp_pool;)o=F.zpp_pool.next,F.zpp_pool.next=null,F.zpp_pool=o;for(;null!=V.zpp_pool;)o=V.zpp_pool.next,V.zpp_pool.next=null,V.zpp_pool=o;for(;null!=W.zpp_pool;)o=W.zpp_pool.next,W.zpp_pool.next=null,W.zpp_pool=o;for(;null!=R.zpp_pool;)o=R.zpp_pool.next,R.zpp_pool.next=null,R.zpp_pool=o;for(;null!=j.zpp_pool;)o=j.zpp_pool.next,j.zpp_pool.next=null,j.zpp_pool=o;for(;null!=K.zpp_pool;)o=K.zpp_pool.next,K.zpp_pool.next=null,K.zpp_pool=o;for(;null!=G.zpp_pool;)o=G.zpp_pool.next,G.zpp_pool.next=null,G.zpp_pool=o;for(;null!=H.zpp_pool;)o=H.zpp_pool.next,H.zpp_pool.next=null,H.zpp_pool=o;for(;null!=q.zpp_pool;)o=q.zpp_pool.next,q.zpp_pool.next=null,q.zpp_pool=o;for(;null!=J.zpp_pool;)o=J.zpp_pool.next,J.zpp_pool.next=null,J.zpp_pool=o;for(;null!=U.zpp_pool;)o=U.zpp_pool.next,U.zpp_pool.next=null,U.zpp_pool=o;for(;null!=Q.zpp_pool;)o=Q.zpp_pool.next,Q.zpp_pool.next=null,Q.zpp_pool=o;for(;null!=X.zpp_pool;)o=X.zpp_pool.next,X.zpp_pool.next=null,X.zpp_pool=o;for(;null!=Y.zpp_pool;)o=Y.zpp_pool.next,Y.zpp_pool.next=null,Y.zpp_pool=o;for(;null!=no.zpp_pool;)o=no.zpp_pool.next,no.zpp_pool.next=null,no.zpp_pool=o;for(;null!=$.zpp_pool;)o=$.zpp_pool.next,$.zpp_pool.next=null,$.zpp_pool=o;for(;null!=oo.zpp_pool;)o=oo.zpp_pool.next,oo.zpp_pool.next=null,oo.zpp_pool=o;for(;null!=po.zpp_pool;)o=po.zpp_pool.next,po.zpp_pool.next=null,po.zpp_pool=o;for(;null!=to.zpp_pool;)o=to.zpp_pool.next,to.zpp_pool.next=null,to.zpp_pool=o;for(;null!=eo.zpp_pool;)o=eo.zpp_pool.next,eo.zpp_pool.next=null,eo.zpp_pool=o;for(;null!=lo.zpp_pool;)o=lo.zpp_pool.next,lo.zpp_pool.next=null,lo.zpp_pool=o;for(;null!=io.zpp_pool;)o=io.zpp_pool.next,io.zpp_pool.next=null,io.zpp_pool=o;for(;null!=ro.zpp_pool;)o=ro.zpp_pool.next,ro.zpp_pool.next=null,ro.zpp_pool=o;for(;null!=ao.zpp_pool;)o=ao.zpp_pool.next,ao.zpp_pool.next=null,ao.zpp_pool=o;for(;null!=so.zpp_pool;)o=so.zpp_pool.next,so.zpp_pool.next=null,so.zpp_pool=o;for(;null!=_o.zpp_pool;)o=_o.zpp_pool.next,_o.zpp_pool.next=null,_o.zpp_pool=o;for(;null!=uo.zpp_pool;)o=uo.zpp_pool.next,uo.zpp_pool.next=null,uo.zpp_pool=o;for(;null!=zo.zpp_pool;)o=zo.zpp_pool.next,zo.zpp_pool.next=null,zo.zpp_pool=o;for(;null!=ho.zpp_pool;)o=ho.zpp_pool.next,ho.zpp_pool.next=null,ho.zpp_pool=o;for(;null!=xo.zpp_pool;)o=xo.zpp_pool.next,xo.zpp_pool.next=null,xo.zpp_pool=o;for(;null!=co.zpp_pool;)o=co.zpp_pool.next,co.zpp_pool.next=null,co.zpp_pool=o;for(;null!=fo.zpp_pool;)o=fo.zpp_pool.next,fo.zpp_pool.next=null,fo.zpp_pool=o;for(;null!=yo.zpp_pool;)o=yo.zpp_pool.next,yo.zpp_pool.next=null,yo.zpp_pool=o;for(;null!=bo.zpp_pool;)o=bo.zpp_pool.next,bo.zpp_pool.next=null,bo.zpp_pool=o;for(;null!=Po.zpp_pool;)o=Po.zpp_pool.next,Po.zpp_pool.next=null,Po.zpp_pool=o;for(;null!=mo.zpp_pool;)o=mo.zpp_pool.next,mo.zpp_pool.next=null,mo.zpp_pool=o;for(;null!=go.zpp_pool;)o=go.zpp_pool.next,go.zpp_pool.next=null,go.zpp_pool=o;for(;null!=wo.zpp_pool;)o=wo.zpp_pool.next,wo.zpp_pool.next=null,wo.zpp_pool=o;for(;null!=vo.zpp_pool;)o=vo.zpp_pool.next,vo.zpp_pool.next=null,vo.zpp_pool=o;for(;null!=Co.zpp_pool;)o=Co.zpp_pool.next,Co.zpp_pool.next=null,Co.zpp_pool=o;for(;null!=So.zpp_pool;)o=So.zpp_pool.next,So.zpp_pool.next=null,So.zpp_pool=o;for(;null!=Zo.zpp_pool;)o=Zo.zpp_pool.next,Zo.zpp_pool.next=null,Zo.zpp_pool=o;for(;null!=Ao.zpp_pool;)o=Ao.zpp_pool.next,Ao.zpp_pool.next=null,Ao.zpp_pool=o;for(;null!=Ro.zpp_pool;)o=Ro.zpp_pool.next,Ro.zpp_pool.next=null,Ro.zpp_pool=o;for(;null!=jo.zpp_pool;)o=jo.zpp_pool.next,jo.zpp_pool.next=null,jo.zpp_pool=o;for(;null!=Mo.zpp_pool;)o=Mo.zpp_pool.next,Mo.zpp_pool.next=null,Mo.zpp_pool=o;for(;null!=To.zpp_pool;)o=To.zpp_pool.next,To.zpp_pool.next=null,To.zpp_pool=o;for(;null!=No.zpp_pool;)o=No.zpp_pool.next,No.zpp_pool.next=null,No.zpp_pool=o;for(;null!=Oo.zpp_pool;)o=Oo.zpp_pool.next,Oo.zpp_pool.next=null,Oo.zpp_pool=o;for(;null!=Do.zpp_pool;)o=Do.zpp_pool.next,Do.zpp_pool.next=null,Do.zpp_pool=o;for(;null!=Io.zpp_pool;)o=Io.zpp_pool.next,Io.zpp_pool.next=null,Io.zpp_pool=o;for(;null!=Bo.zpp_pool;)o=Bo.zpp_pool.next,Bo.zpp_pool.next=null,Bo.zpp_pool=o;for(;null!=ko.zpp_pool;)o=ko.zpp_pool.next,ko.zpp_pool.next=null,ko.zpp_pool=o;for(;null!=Lo.zpp_pool;)o=Lo.zpp_pool.next,Lo.zpp_pool.next=null,Lo.zpp_pool=o;for(;null!=Eo.zpp_pool;)o=Eo.zpp_pool.next,Eo.zpp_pool.next=null,Eo.zpp_pool=o;for(;null!=Fo.zpp_pool;)o=Fo.zpp_pool.next,Fo.zpp_pool.next=null,Fo.zpp_pool=o;for(;null!=Vo.zpp_pool;)o=Vo.zpp_pool.next,Vo.zpp_pool.next=null,Vo.zpp_pool=o;for(;null!=Wo.poolGeomPoly;)o=Wo.poolGeomPoly.zpp_pool,Wo.poolGeomPoly.zpp_pool=null,Wo.poolGeomPoly=o;for(;null!=Wo.poolVec2;)o=Wo.poolVec2.zpp_pool,Wo.poolVec2.zpp_pool=null,Wo.poolVec2=o;for(;null!=Wo.poolVec3;)o=Wo.poolVec3.zpp_pool,Wo.poolVec3.zpp_pool=null,Wo.poolVec3=o},o.TIMES=function(p){var t="",n=p.timeStamp-o.ltime;return t+="Validation:    "+(o.VALID/n).toString().substr(0,5)+"ms\n",t+="Broadphase:    "+((o.BROAD-o.NARROW)/n).toString().substr(0,5)+"ms :: total = "+(o.BROAD/n).toString().substr(0,5)+"ms\n",t+="Narrowphase:   "+(o.NARROW/n).toString().substr(0,5)+"ms\n",t+="Set-Forest:    "+(o.FOR/n).toString().substr(0,5)+"ms\n",t+="Prestep:       "+(o.PRE/n).toString().substr(0,5)+"ms\n",t+="Contact sort:  "+(o.SORT/n).toString().substr(0,5)+"ms\n",t+="Position It.:  "+(o.POS/n).toString().substr(0,5)+"ms\n",t+="Velocity It.:  "+(o.VEL/n).toString().substr(0,5)+"ms\n",t+="Debug Draw:    "+(o.DRAW/n).toString().substr(0,5)+"ms\n",t+="\n",t+="arb:        "+o.ACNT+"\n",t+="active arb: "+o.AACNT+"\n",t+="con:        "+o.CCNT+"\n",t+="active con: "+o.ACCNT+"\n",t+="\n",t+="hash collisions: "+(o.HASH/o.HASHT*100).toString().substr(0,5)+"%\n",t+="\n",t+="Broadphase adjustments: "+(o.BROADCLASH/o.BROADTOTAL*100).toString().substr(0,5)+"%\n",p.timeStamp-o.ltime>50&&(o.FOR=o.BROAD=o.PRE=o.POS=o.VEL=o.DRAW=o.VALID=o.SORT=o.NARROW=o.BROADCLASH=o.BROADTOTAL=0,o.ltime=p.timeStamp),t},o.createGraphic=function(p){if(null==p)throw new Error("Error: Cannot create debug graphic for null Body");var t=new createjs.Shape,n=t.graphics,e=Math.floor(16777215*Math.exp(-p.id/1500)),l=.7*((16711680&e)>>16),i=.7*((65280&e)>>8),r=.7*(255&e),a=Math.floor(l)<<16|Math.floor(i)<<8|Math.floor(r);o.lineStyle(n,.1,a,1);for(var s=p.shapes.iterator();s.hasNext();){var _=s.next();if(_.isCircle()){var u=_.castCircle;n.drawCircle(u.localCOM.x,u.localCOM.y,u.radius)}else{var d=_.castPolygon;n.moveTo(_.localCOM.x,_.localCOM.y);for(var z=-0,h=d.worldVerts.length;z<h;z++){var x=d.localVerts.at(z);n.lineTo(x.x,x.y)}x=d.localVerts.at(0),n.lineTo(x.x,x.y)}_.isCircle()&&(u=_.castCircle,n.moveTo(u.localCOM.x+.3*u.radius,u.localCOM.y),n.lineTo(u.localCOM.x+u.radius,u.localCOM.y))}return t},Object.defineProperty(o.prototype,"bgColour",{get:function(){return this.zpp_inner.bg_col},set:function(o){this.zpp_inner.d_shape.setbg(o)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"display",{get:function(){return this.zpp_inner.d_shape.shape},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"transform",{get:function(){return null==this.zpp_inner.xform&&this.zpp_inner.setform(),this.zpp_inner.xform.outer},set:function(o){this.transform.set(o)},enumerable:!0,configurable:!0}),o.prototype.clear=function(){},o.prototype.flush=function(){},o.prototype.draw=function(o){},o.prototype.drawLine=function(o,p,t){},o.prototype.drawCurve=function(o,p,t,n){},o.prototype.drawCircle=function(o,p,t){},o.prototype.drawAABB=function(o,p){},o.prototype.drawFilledTriangle=function(o,p,t,n){},o.prototype.drawFilledCircle=function(o,p,t){},o.prototype.drawPolygon=function(o,p){},o.prototype.drawFilledPolygon=function(o,p){},o.prototype.drawSpring=function(o,p,t,n,e){void 0===n&&(n=3),void 0===e&&(e=3)},o.lineStyle=function(o,p,t,n){void 0===n&&(n=1);var e=(16711680&t)>>16,l=(65280&t)>>8,i=255&t;o.setStrokeStyle(p).beginStroke("rgba("+e+","+l+","+i+","+n+")")},o.WEAK=function(o){return!!o.zpp_inner.weak&&(o.dispose(),!0)},o.PolyWeak=function(p){if(p instanceof Array&&null==p.__enum__)for(var t=p,n=0;n<t.length;){var e=t[n];o.WEAK(e)?t.splice(n,1):n++}else if(p instanceof qo){null!=(t=p).zpp_inner._validate&&t.zpp_inner._validate();var l=t.zpp_inner.inner,i=null;for(e=l.begin();null!=e;){var r=e.elem();r.outer.zpp_inner.weak?(e=l.erase(i),o.WEAK(r.outer)):(i=e,e=e.next)}}},o.PolyIter=function(o,p){if(o instanceof Array&&null==o.__enum__)for(var t in o)p(o[t]);else if(o instanceof qo)for(var n=o.iterator();n.hasNext();)p(n.next());else if(o instanceof Jo)for(n=o.iterator();n.hasNext();)p(n.next())},o.debug_draw=function(o,p){o.zpp_inner.xnull?p instanceof Ko?o.zpp_inner_zn.draw_space(p.zpp_inner,null,1,!0):p instanceof Uo?o.zpp_inner_zn.draw_compound(p.zpp_inner,null,1,!0):p instanceof Go?o.zpp_inner_zn.draw_body(p.zpp_inner,null,1,!0):p instanceof Qo?o.zpp_inner_zn.draw_shape(p.zpp_inner,null,1,!0):p instanceof Xo&&p.zpp_inner.draw(o):p instanceof Ko?o.zpp_inner_zn.draw_space(p.zpp_inner,o.zpp_inner.xform,o.zpp_inner.xdet,!1):p instanceof Go?o.zpp_inner_zn.draw_body(p.zpp_inner,o.zpp_inner.xform,o.zpp_inner.xdet,!1):p instanceof Qo?o.zpp_inner_zn.draw_shape(p.zpp_inner,o.zpp_inner.xform,o.zpp_inner.xdet,!1):p instanceof Xo&&p.zpp_inner.draw(o)},o.debug_spring=function(p,t,n,e,l,i){if(0==l)p.drawLine(t,n,e);else{var r=n.x-t.x,a=n.y-t.y,s=r*=z=1/(4*l),_=a*=z;if(s*s+_*_<.1)return;var u=s*s+_*_,d=1/Math.sqrt(u),z=s*=d;s=-(_*=d),_=z,s*=z=2*i,_*=z;for(var h=t.copy(),x=Ho.get(0,0,!1),c=Ho.get(0,0,!1),f=0;f<l;f++)x.x=h.x+r+s,x.y=h.y+a+_,c.x=h.x+2*r,c.y=h.y+2*a,p.drawCurve(h,x,c,e),h.x=c.x,h.y=c.y,x.x=h.x+r-s,x.y=h.y+a-_,c.x=h.x+2*r,c.y=h.y+2*a,p.drawCurve(h,x,c,e),h.x=c.x,h.y=c.y;h.dispose(),x.dispose(),c.dispose()}o.WEAK(t),o.WEAK(n)},o.ltime=0,o.ACNT=0,o.AACNT=0,o.CCNT=0,o.ACCNT=0,o.FOR=0,o.PRE=0,o.VEL=0,o.POS=0,o.BROAD=0,o.NARROW=0,o.DRAW=0,o.VALID=0,o.SORT=0,o.HASH=0,o.HASHT=0,o.BROADCLASH=0,o.BROADTOTAL=0,o}(),p.Debug=Yo}(nape||(nape={})),function(o){var p,t,n,e,l;p=o.util||(o.util={}),t=o.geom.ZPP_AABB,n=nape.geom.Vec2,e=nape.geom.Mat23,l=function(){function o(o,p){this.outer=null,this.isbmp=!1,this.d_shape=null,this.bg_r=0,this.bg_g=0,this.bg_b=0,this.bg_col=0,this.xform=null,this.xnull=!1,this.xdet=0,this.width=0,this.height=0,this.viewport=null,this.iport=null,this.tmpab=null,this.xnull=!0,this.xdet=1,this.width=o,this.height=p,this.viewport=t.get(0,0,o,p),this.iport=t.get(0,0,o,p),this.tmpab=new t}return o.prototype.xform_invalidate=function(){var o=this.xform.outer.determinant;this.xdet=Math.sqrt(o<0?-o:o),this.xnull=1==this.xform.a&&0==this.xform.b&&0==this.xform.c&&1==this.xform.d&&0==this.xform.tx&&0==this.xform.ty;var p=this.xform.outer.inverse(),t=n.get(0,0,!1),e=p.transform(t);this.iport.minx=e.x,this.iport.miny=e.y,this.iport.maxx=this.iport.minx,this.iport.maxy=this.iport.miny,e.dispose(),t.x=this.width,e=p.transform(t),this.iport.setExpandPoint(e.x,e.y),e.dispose(),t.y=this.height,e=p.transform(t),this.iport.setExpandPoint(e.x,e.y),e.dispose(),t.x=0,e=p.transform(t),this.iport.setExpandPoint(e.x,e.y),e.dispose(),t.dispose()},o.prototype.setform=function(){this.xform=(new e).zpp_inner,this.xform._invalidate=this.xform_invalidate},o.prototype.cull=function(o){if(this.xnull)return o.intersect(this.viewport);var p=0,t=0,n=0,e=0;return n=o.minx,e=o.miny,this.tmpab.minx=this.xform.a*n+this.xform.b*e+this.xform.tx,this.tmpab.miny=this.xform.c*n+this.xform.d*e+this.xform.ty,this.tmpab.maxx=this.tmpab.minx,this.tmpab.maxy=this.tmpab.miny,n=o.maxx,p=this.xform.a*n+this.xform.b*e+this.xform.tx,t=this.xform.c*n+this.xform.d*e+this.xform.ty,this.tmpab.setExpandPoint(p,t),e=o.maxy,p=this.xform.a*n+this.xform.b*e+this.xform.tx,t=this.xform.c*n+this.xform.d*e+this.xform.ty,this.tmpab.setExpandPoint(p,t),n=o.minx,p=this.xform.a*n+this.xform.b*e+this.xform.tx,t=this.xform.c*n+this.xform.d*e+this.xform.ty,this.tmpab.setExpandPoint(p,t),this.tmpab.intersect(this.viewport)},o.prototype.sup_setbg=function(o){this.bg_r=o>>16&255,this.bg_g=o>>8&255,this.bg_b=255&o,this.bg_col=o},o.prototype.colour=function(o,p){var t,n=.7*((16711680&(t=null==this.outer.colour?Math.floor(16777215*Math.exp(-o%500/1500)):this.outer.colour(o)))>>16),e=.7*((65280&t)>>8),l=.7*(255&t);return p&&(n=.4*n+.6*this.bg_r,e=.4*e+.6*this.bg_g,l=.4*l+.6*this.bg_b),4278190080|Math.floor(n)<<16|Math.floor(e)<<8|Math.floor(l)},o.prototype.tint=function(o,p,t){var n=o,e=p,l=t;return 4278190080|Math.floor((n>>16&255)*l+(e>>16&255)*(1-l))<<16|Math.floor((n>>8&255)*l+(e>>8&255)*(1-l))<<8|Math.floor((255&n)*l+(255&e)*(1-l))},o.internal=!1,o}(),p.ZPP_Debug=l}(zpp_nape||(zpp_nape={}));var zpp_nape,nape,__extends=this&&this.__extends||function(o,p){for(var t in p)p.hasOwnProperty(t)&&(o[t]=p[t]);function n(){this.constructor=o}o.prototype=null===p?Object.create(p):(n.prototype=p.prototype,new n)};!function(o){var p,t;t=function(o){function t(p,t){o.call(this,p,t),this.outer_zn=null,this.shape=null,this.graphics=null,this.compoundstack=null,this.shapeList=null,this.bodyList=null,this.shape=new createjs.Shape,this.graphics=this.shape.graphics,this.isbmp=!1,this.d_shape=this}return __extends(t,o),t.prototype.setbg=function(o){this.sup_setbg(o)},t.prototype.draw_compound=function(o,p,t,n){for(var e=o.compounds.begin();null!=e;){var l=e.elem();this.draw_compound(l,p,t,n),e=e.next}for(e=o.bodies.begin();null!=e;){var i=e.elem();i.outer.debugDraw&&this.draw_body(i,p,t,n),e=e.next}for(e=o.constraints.begin();null!=e;)(l=e.elem()).active&&l.outer.debugDraw&&l.draw(this.outer),e=e.next},t.prototype.draw_space=function(o,t,n,e){if(this.outer.cullingEnabled){if(this.outer.drawBodies)if(this.outer.drawBodyDetail)for(var l=this.bodyList=o.bphase.bodiesInAABB(this.iport,!1,!1,null,this.bodyList);!l.empty();){var i=l.shift();i.debugDraw&&this.draw_body(i.zpp_inner,t,n,e)}else for(var r=this.shapeList=o.bphase.shapesInAABB(this.iport,!1,!1,null,this.shapeList);!r.empty();){var a=r.shift();a.body.debugDraw&&this.draw_shape(a.zpp_inner,t,n,e)}}else if(this.outer.drawBodies){null==this.compoundstack&&(this.compoundstack=new p.ZNPList_ZPP_Compound);for(var s=o.bodies.begin();null!=s;){var _=s.elem();_.outer.debugDraw&&this.draw_body(_,t,n,e),s=s.next}for(s=o.compounds.begin();null!=s;){var u=s.elem();this.compoundstack.add(u),s=s.next}for(;!this.compoundstack.empty();){for(s=(x=this.compoundstack.pop_unsafe()).bodies.begin();null!=s;){var d=s.elem();d.outer.debugDraw&&this.draw_body(d,t,n,e),s=s.next}for(s=x.compounds.begin();null!=s;)u=s.elem(),this.compoundstack.add(u),s=s.next}}if(this.outer.drawCollisionArbiters||this.outer.drawFluidArbiters||this.outer.drawSensorArbiters)for(var z=o.outer.arbiters.iterator();z.hasNext();){var h=z.next();this.draw_arbiter(h.zpp_inner,t,n,e)}if(this.outer.drawConstraints){for(null==this.compoundstack&&(this.compoundstack=new p.ZNPList_ZPP_Compound),s=o.constraints.begin();null!=s;)(u=s.elem()).active&&u.outer.debugDraw&&u.draw(this.outer),s=s.next;for(s=o.compounds.begin();null!=s;)u=s.elem(),this.compoundstack.add(u),s=s.next;for(;!this.compoundstack.empty();){var x;for(s=(x=this.compoundstack.pop_unsafe()).constraints.begin();null!=s;)(u=s.elem()).active&&u.outer.debugDraw&&u.draw(this.outer),s=s.next;for(s=x.compounds.begin();null!=s;)u=s.elem(),this.compoundstack.add(u),s=s.next}}},t.prototype.draw_body=function(o,p,t,n){for(var e=this.graphics,l=o.shapes.begin();null!=l;){var i=l.elem();this.draw_shape(i,p,t,n),l=l.next}if(this.outer.drawBodyDetail){var r=this.colour(o.id,null!=o.space&&o.outer.isSleeping);this.lineStyle(this.tint(r,16711680,.8),1);var a=0,s=0,_=0,u=0;o.shapes.empty()||(o.validate_worldCOM(),n?(a=o.worldCOMx,s=o.worldCOMy):(a=p.a*o.worldCOMx+p.b*o.worldCOMy+p.tx,s=p.c*o.worldCOMx+p.d*o.worldCOMy+p.ty),e.drawCircle(a,s,1),o.validate_aabb(),this.AABB(o,n,p,o.aabb)),n?(_=o.pre_posx,u=o.pre_posy):(_=p.a*o.pre_posx+p.b*o.pre_posy+p.tx,u=p.c*o.pre_posx+p.d*o.pre_posy+p.ty),n?(a=o.posx,s=o.posy):(a=p.a*o.posx+p.b*o.posy+p.tx,s=p.c*o.posx+p.d*o.posy+p.ty),e.moveTo(_,u),e.lineTo(a,s),e.drawCircle(a,s,1)}},t.prototype.draw_shape=function(o,p,t,n){var e=this.graphics,l=this.outer,i=this.colour(o.id,!1),r=o.body;if(null!=r){var a=this.colour(r.id,null!=r.space&&r.outer.isSleeping);if(i=this.tint(i,a,.2),this.lineStyle(i,1),o.isCircle()){var s=o.circle;s.validate_worldCOM();var _=s.worldCOMx,u=s.worldCOMy;if(!n){var d=p.a*_+p.b*u+p.tx;u=p.c*_+p.d*u+p.ty,_=d}if(e.drawCircle(_,u,s.radius*t),l.drawShapeAngleIndicators){var z=s.worldCOMx+.3*s.radius*r.axisy,h=s.worldCOMy+.3*s.radius*r.axisx,x=s.worldCOMx+s.radius*r.axisy,c=s.worldCOMy+s.radius*r.axisx;n||(d=p.a*z+p.b*h+p.tx,h=p.c*z+p.d*h+p.ty,z=d),n||(d=p.a*x+p.b*c+p.tx,c=p.c*x+p.d*c+p.ty,x=d),e.moveTo(z,h),e.lineTo(x,c)}}else{var f=o.polygon;f.validate_gverts();var y=f.gverts.front(),b=y.x,P=y.y;if(!n){var m=p.a*b+p.b*P+p.tx;P=p.c*b+p.d*P+p.ty,b=m}e.moveTo(b,P);for(var g=b,w=P,v=f.gverts.begin().next;null!=v;){var C=v.elem();if(b=C.x,P=C.y,!n){var S=p.a*b+p.b*P+p.tx;P=p.c*b+p.d*P+p.ty,b=S}e.lineTo(b,P),v=v.next}e.lineTo(g,w),l.drawShapeAngleIndicators&&(f.validate_worldCOM(),n?(b=f.worldCOMx,P=f.worldCOMy):(b=p.a*f.worldCOMx+p.b*f.worldCOMy+p.tx,P=p.c*f.worldCOMx+p.d*f.worldCOMy+p.ty),e.moveTo(b,P),e.lineTo(g,w))}if(l.drawShapeDetail){o.validate_worldCOM(),this.lineStyle(this.tint(i,16711680,.8),1);var Z=0,A=0;n?(Z=o.worldCOMx,A=o.worldCOMy):(Z=p.a*o.worldCOMx+p.b*o.worldCOMy+p.tx,A=p.c*o.worldCOMx+p.d*o.worldCOMy+p.ty),e.drawCircle(Z,A,1),o.validate_aabb(),this.AABB(r,n,p,o.aabb)}}},t.prototype.draw_arbiter=function(o,p,t,n){var e=this.outer,l=0,i=0;if(o.outer.isSensorArbiter()){if(e.drawSensorArbiters){var r=o.outer;this.lineStyle(this.tint(65280,~this.bg_col,.7),1),n?(l=r.shape1.worldCOM.x,i=r.shape1.worldCOM.y):(l=p.a*r.shape1.worldCOM.x+p.b*r.shape1.worldCOM.y+p.tx,i=p.c*r.shape1.worldCOM.x+p.d*r.shape1.worldCOM.y+p.ty),this.graphics.moveTo(l,i),n?(l=r.shape2.worldCOM.x,i=r.shape2.worldCOM.y):(l=p.a*r.shape2.worldCOM.x+p.b*r.shape2.worldCOM.y+p.tx,i=p.c*r.shape2.worldCOM.x+p.d*r.shape2.worldCOM.y+p.ty),this.graphics.lineTo(l,i)}}else if(o.outer.isFluidArbiter()){if(e.drawFluidArbiters){var a=o.outer.fluidArbiter;this.lineStyle(this.tint(255,~this.bg_col,.7),1),n?(l=a.position.x,i=a.position.y):(l=p.a*a.position.x+p.b*a.position.y+p.tx,i=p.c*a.position.x+p.d*a.position.y+p.ty),this.graphics.drawCircle(l,i,.75)}}else if(e.drawCollisionArbiters){var s=o.outer.collisionArbiter;if(!s.contacts.empty()){var _=0,u=0;if(2==s.contacts.length){var d=s.contacts.at(0).position,z=s.contacts.at(1).position,h=s.normal,x=.661437828,c=.75;if(h.y*d.x-h.x*d.y<h.y*z.x-h.x*z.y&&(x=-x,c=-c),this.lineStyle(this.tint(255,~this.bg_col,.7),1),l=d.x+h.x*c-h.y*x,i=d.y+h.y*c+h.x*x,!n){var f=p.a*l+p.b*i+p.tx;i=p.c*l+p.d*i+p.ty,l=f}this.graphics.moveTo(l,i),l=z.x+h.x*c+h.y*x,i=z.y+h.y*c-h.x*x,n||(f=p.a*l+p.b*i+p.tx,i=p.c*l+p.d*i+p.ty,l=f),this.graphics.lineTo(l,i),this.lineStyle(this.tint(16711680,~this.bg_col,.7),1),l=d.x-h.x*c-h.y*x,i=d.y-h.y*c+h.x*x,n||(f=p.a*l+p.b*i+p.tx,i=p.c*l+p.d*i+p.ty,l=f),this.graphics.moveTo(l,i),l=z.x-h.x*c+h.y*x,i=z.y-h.y*c-h.x*x,n||(f=p.a*l+p.b*i+p.tx,i=p.c*l+p.d*i+p.ty,l=f),this.graphics.lineTo(l,i),_=.5*(d.x+z.x),u=.5*(d.y+z.y),n||(f=p.a*_+p.b*u+p.tx,u=p.c*_+p.d*u+p.ty,_=f)}else _=s.contacts.at(0).position.x,u=s.contacts.at(0).position.y,n||(f=p.a*_+p.b*u+p.tx,u=p.c*_+p.d*u+p.ty,_=f),this.lineStyle(this.tint(16711935,~this.bg_col,.7),1),this.graphics.drawCircle(_,u,1);this.lineStyle(this.tint(~this.bg_col,this.bg_col,.7),1),this.graphics.moveTo(_,u),l=5*s.normal.x,i=5*s.normal.y,n||(f=p.a*l+p.b*i,i=p.c*l+p.d*i,l=f),this.graphics.lineTo(_+l,u+i)}}},t.prototype.lineStyle=function(o,p,t){void 0===t&&(t=1),2==arguments.length&&(t=p,p=o,o=this.outer_zn.thickness);var n=(16711680&p)>>16,e=(65280&p)>>8,l=255&p;this.graphics.setStrokeStyle(o).beginStroke("rgba("+n+","+e+","+l+","+t+")")},t.prototype.AABB=function(o,p,t,n){if(p)this.graphics.drawRect(o.aabb.minx,o.aabb.miny,o.aabb.width(),o.aabb.height());else{var e,l;e=t.a*o.aabb.minx+t.b*o.aabb.miny+t.tx,l=t.c*o.aabb.minx+t.d*o.aabb.miny+t.ty;var i=o.aabb.width(),r=0,a=t.a*i+t.b*r;r=t.c*i+t.d*r,i=a;var s=0,_=o.aabb.height();a=t.a*s+t.b*_,_=t.c*s+t.d*_,s=a,this.graphics.moveTo(e,l),this.graphics.lineTo(e+i,l+r),this.graphics.lineTo(e+i+s,l+r+_),this.graphics.lineTo(e+s,l+_),this.graphics.lineTo(e,l)}},t}((p=o.util||(o.util={})).ZPP_Debug),p.ZPP_ShapeDebug=t}(zpp_nape||(zpp_nape={})),__extends=this&&this.__extends||function(o,p){for(var t in p)p.hasOwnProperty(t)&&(o[t]=p[t]);function n(){this.constructor=o}o.prototype=null===p?Object.create(p):(n.prototype=p.prototype,new n)},function(o){var p,t,n,e;p=o.util||(o.util={}),t=zpp_nape.util.ZPP_ShapeDebug,n=o.geom.Vec2,e=function(o){function e(p,n,e){void 0===e&&(e=3355443),o.call(this),this.zpp_inner_zn=null,this.thickness=0,this.zpp_inner_zn=new t(p,n),this.zpp_inner_zn.outer_zn=this,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.bgColour=e,this.thickness=.1}return __extends(e,o),e.prototype.clear=function(){this.zpp_inner_zn.graphics.clear()},e.prototype.drawLine=function(o,t,n){var e=this.zpp_inner,l=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(l,this.thickness,16777215&n,1),e.xnull)l.moveTo(o.x,o.y),l.lineTo(t.x,t.y),p.Debug.WEAK(o),p.Debug.WEAK(t);else{var i=e.xform.outer.transform(o);l.moveTo(i.x,i.y),i.dispose(),i=e.xform.outer.transform(t),l.lineTo(i.x,i.y),i.dispose()}l.endStroke()},e.prototype.drawCurve=function(o,t,n,e){var l=this.zpp_inner,i=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(i,this.thickness,16777215&e,1),l.xnull)i.moveTo(o.x,o.y),i.curveTo(t.x,t.y,n.x,n.y),p.Debug.WEAK(o),p.Debug.WEAK(t),p.Debug.WEAK(n);else{var r=l.xform.outer.transform(o),a=l.xform.outer.transform(t),s=l.xform.outer.transform(n);i.moveTo(r.x,r.y),i.curveTo(a.x,a.y,s.x,s.y),r.dispose(),a.dispose(),s.dispose()}i.endStroke()},e.prototype.drawCircle=function(o,t,n){var e=this.zpp_inner,l=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(l,this.thickness,16777215&n,1),e.xnull)l.drawCircle(o.x,o.y,t),p.Debug.WEAK(o);else{var i=e.xform.outer.transform(o);l.drawCircle(i.x,i.y,t*e.xdet),i.dispose()}l.endStroke()},e.prototype.drawAABB=function(o,t){var e=this.zpp_inner,l=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(l,this.thickness,16777215&t,1),e.xnull)l.drawRect(o.x,o.y,o.width,o.height);else{var i=e.xform.outer.transform(o.min),r=n.get(o.width,0,!1),a=e.xform.outer.transform(r,!0),s=n.get(0,o.height,!1),_=e.xform.outer.transform(s,!0);l.moveTo(i.x,i.y),l.lineTo(i.x+a.x,i.y+a.y),l.lineTo(i.x+a.x+_.x,i.y+a.y+_.y),l.lineTo(i.x+_.x,i.y+_.y),l.lineTo(i.x,i.y),i.dispose(),r.dispose(),a.dispose(),s.dispose(),_.dispose()}l.endStroke()},e.prototype.drawFilledTriangle=function(o,t,n,e){var l=this.zpp_inner,i=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(i,0,0,0),i.beginFill(this.rgba(16777215&e,1)),l.xnull)i.moveTo(o.x,o.y),i.lineTo(t.x,t.y),i.lineTo(n.x,n.y),p.Debug.WEAK(o),p.Debug.WEAK(t),p.Debug.WEAK(n);else{var r=l.xform.outer.transform(o);i.moveTo(r.x,r.y),r.dispose(),r=l.xform.outer.transform(t),i.lineTo(r.x,r.y),r.dispose(),r=l.xform.outer.transform(n),i.lineTo(r.x,r.y),r.dispose()}i.endFill()},e.prototype.drawFilledCircle=function(o,t,n){var e=this.zpp_inner,l=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(l,0,0,0),l.beginFill(this.rgba(16777215&n,1)),e.xnull)l.drawCircle(o.x,o.y,t),p.Debug.WEAK(o);else{var i=e.xform.outer.transform(o);l.drawCircle(i.x,i.y,t*e.xdet),i.dispose()}l.endFill()},e.prototype.drawPolygon=function(o,t){var n=this.zpp_inner,e=this.zpp_inner_zn.graphics;p.Debug.lineStyle(e,this.thickness,16777215&t,1);var l=null,i=!0;n.xnull?(p.Debug.PolyIter(o,function(o){i?(l=o.copy(!1),e.moveTo(o.x,o.y)):e.lineTo(o.x,o.y),i=!1}),e.lineTo(l.x,l.y),l.dispose()):(p.Debug.PolyIter(o,function(o){var p=n.xform.outer.transform(o);i?(l=p,e.moveTo(p.x,p.y)):e.lineTo(p.x,p.y),i||p.dispose(),i=!1}),e.lineTo(l.x,l.y),l.dispose()),p.Debug.PolyWeak(o),e.endStroke()},e.prototype.drawFilledPolygon=function(o,t){var n=this.zpp_inner,e=this.zpp_inner_zn.graphics;e.beginFill(this.rgba(16777215&t,1)),p.Debug.lineStyle(e,0,0,0);var l=null,i=!0;n.xnull?(p.Debug.PolyIter(o,function(o){i?(l=o.copy(!1),e.moveTo(o.x,o.y)):e.lineTo(o.x,o.y),i=!1}),e.lineTo(l.x,l.y),l.dispose()):(p.Debug.PolyIter(o,function(o){var p=n.xform.outer.transform(o);i?(l=p,e.moveTo(p.x,p.y)):e.lineTo(p.x,p.y),i||p.dispose(),i=!1}),e.lineTo(l.x,l.y),l.dispose()),e.endFill(),p.Debug.PolyWeak(o)},e.prototype.draw=function(o){p.Debug.debug_draw(this,o)},e.prototype.drawSpring=function(o,t,n,e,l){void 0===e&&(e=3),void 0===l&&(l=3),p.Debug.debug_spring(this,o,t,n,e,l)},e.prototype.rgba=function(o,p){return void 0===p&&(p=1),"rgba("+((16711680&o)>>16)+","+((65280&o)>>8)+","+(255&o)+","+p+")"},e}(p.Debug),p.ShapeDebug=e}(nape||(nape={}));