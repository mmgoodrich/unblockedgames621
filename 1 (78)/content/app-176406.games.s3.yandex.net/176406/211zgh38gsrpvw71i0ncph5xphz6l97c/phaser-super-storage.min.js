var PhaserSuperStorage;!function(e){!function(e){var t=function(){function e(e){void 0===e&&(e=""),this.namespace="",this.forcePromises=!1,this.setNamespace(e)}return Object.defineProperty(e.prototype,"length",{get:function(){return null!==this.getNameSpaceMatches()?this.getNameSpaceMatches().length:0},enumerable:!0,configurable:!0}),e.prototype.key=function(e){var t=this.getNameSpaceMatches()[e],o=this.getCookiesForNameSpace()[t]||null;return this.forcePromises?this.promisefy(o):o},e.prototype.getItem=function(e){var t=this.getCookiesForNameSpace()[e]||null;return this.forcePromises?this.promisefy(t):t},e.prototype.setItem=function(e,t){if(document.cookie=encodeURIComponent(this.namespace+e)+"="+encodeURIComponent(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/",this.forcePromises)return this.promisefy(null)},e.prototype.removeItem=function(e){if(document.cookie=encodeURIComponent(this.namespace+e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.forcePromises)return this.promisefy(null)},e.prototype.clear=function(){var e=this.getCookiesForNameSpace();for(var t in e)e.hasOwnProperty(t)&&this.removeItem(t);if(this.forcePromises)return this.promisefy(null)},e.prototype.setNamespace=function(e){if(e&&(this.namespace=e+":",this.reg=new RegExp("^"+this.namespace+"[a-zA-Z0-9]*","g")),this.forcePromises)return this.promisefy(e)},e.prototype.getNameSpaceMatches=function(){var e=this;return decodeURIComponent(document.cookie).split("; ").filter(function(t){return null!==t.match(e.reg)&&t.match(e.reg).length>0})},e.prototype.getCookiesForNameSpace=function(){var e=this,t={};return this.getNameSpaceMatches().forEach(function(o){var r=o.replace(e.namespace,"").split("=");t[r[0]]=r[1]}),t},e.prototype.promisefy=function(e){return new Promise(function(t,o){t(e)})},e}();e.CookieStorage=t}(e.StorageAdapters||(e.StorageAdapters={}))}(PhaserSuperStorage||(PhaserSuperStorage={})),function(e){!function(e){var t=function(){function e(){this.namespace="",this.keys=[]}return Object.defineProperty(e.prototype,"forcePromises",{get:function(){return!0},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.keys.length},enumerable:!0,configurable:!0}),e.prototype.key=function(e){return this.promisefy(this.keys[e])},e.prototype.getItem=function(e){var t=this;return new Promise(function(o,r){NativeStorage.getItem(t.namespace+e,function(e){o(e)},function(e){2===e.code?o(null):r(e)})})},e.prototype.setItem=function(e,t){var o=this;return e.length<1?void console.error("CordovaStorage: Key cannot be an empty string!"):new Promise(function(r,n){NativeStorage.setItem(o.namespace+e,t,function(){o.keys.indexOf(e)<0&&(o.keys.push(e),o.save()),r(null)},function(e){n(e)})})},e.prototype.removeItem=function(e){var t=this;return new Promise(function(o,r){NativeStorage.remove(t.namespace+e,function(){var r=t.keys.indexOf(e);r>=0&&(t.keys.splice(r,1),t.save()),o(null)},function(e){r(e)})})},e.prototype.clear=function(){var e=this;return new Promise(function(t,o){for(var r=0,n=0;n<e.keys.length;n++)NativeStorage.remove(e.namespace+e.keys[n],function(){++r>=e.keys.length&&(e.keys=[],e.save(),t(null))},function(e){o(e)})})},e.prototype.setNamespace=function(e){var t=this;return void 0===e&&(e=""),this.namespace=e+":",this.keys=[],new Promise(function(e,o){t.load().then(e).catch(e)})},e.prototype.promisefy=function(e){return new Promise(function(t,o){t(e)})},e.prototype.load=function(){var e=this;return new Promise(function(t,o){NativeStorage.getItem(e.namespace,function(o){e.keys=JSON.parse(o),t(null)},function(e){o(e)})})},e.prototype.save=function(){NativeStorage.setItem(this.namespace,JSON.stringify(this.keys),function(){},function(e){console.warn("CordovaStorage: Failed to save keys of namespace.")})},e}();e.CordovaStorage=t}(e.StorageAdapters||(e.StorageAdapters={}))}(PhaserSuperStorage||(PhaserSuperStorage={})),function(e){var t,o;t=e.StorageAdapters||(e.StorageAdapters={}),o=function(){function t(e,t){void 0===e&&(e=""),void 0===t&&(t="*"),this.namespace="",this.expectedOrigin="",this.storageLength=0,this.enabled=!1,""!==e&&this.setNamespace(e),this.expectedOrigin=t}return Object.defineProperty(t.prototype,"forcePromises",{get:function(){return!0},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.storageLength},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t=this;return this.sendMessage({command:e.StorageCommand.init}).then(function(){t.enabled=!0})},t.prototype.key=function(t){return this.sendMessage({command:e.StorageCommand.key,value:t})},t.prototype.getItem=function(t){return this.sendMessage({command:e.StorageCommand.getItem,key:t})},t.prototype.setItem=function(t,o){return this.sendMessage({command:e.StorageCommand.setItem,key:t,value:o})},t.prototype.removeItem=function(t){return this.sendMessage({command:e.StorageCommand.removeItem,key:t})},t.prototype.clear=function(){return this.sendMessage({command:e.StorageCommand.clear})},t.prototype.setNamespace=function(t){return this.sendMessage({command:e.StorageCommand.setNamespace,value:t})},t.prototype.sendMessage=function(t){var o,r=this;t.command===e.StorageCommand.init&&(o=!1);var n=new MessageChannel;return new Promise(function(a,s){r.enabled||t.command===e.StorageCommand.init||s("Messaging not enabled!"),t.command===e.StorageCommand.init&&setTimeout(function(){o||s("Unable to get a response in time")},1e3),n.port1.onmessage=function(t){console.log("Frame received message",t);var n=e.StorageUtils.validateMessage(t.data);switch(n.command===e.StorageCommand.init&&(o=!0),void 0!==n.status&&"ok"===n.status||s(n.value),void 0!==n.length&&(r.storageLength=n.length),n.command){case e.StorageCommand.setNamespace:r.namespace=n.value+":";case e.StorageCommand.getItem:case e.StorageCommand.length:case e.StorageCommand.key:a(n.value);break;case e.StorageCommand.setItem:case e.StorageCommand.removeItem:case e.StorageCommand.clear:case e.StorageCommand.init:a(n.status);break;default:s(n.value)}},(r.enabled||t.command===e.StorageCommand.init)&&(console.log("Sending message to parent: ",t),window.parent.postMessage(t,r.expectedOrigin,[n.port2]))})},t}(),t.IframeStorage=o}(PhaserSuperStorage||(PhaserSuperStorage={})),function(e){var t,o;t=e.StorageAdapters||(e.StorageAdapters={}),o=function(){function t(e){void 0===e&&(e=""),this.namespace="",this.forcePromises=!1,this.setNamespace(e)}return Object.defineProperty(t.prototype,"length",{get:function(){var t=Object.keys(localStorage);return e.StorageUtils.nameSpaceKeyFilter(t,this.namespace).length},enumerable:!0,configurable:!0}),t.prototype.key=function(e){return this.forcePromises?this.promisefy(this._key,arguments):this._key(e)},t.prototype._key=function(t){var o=Object.keys(localStorage),r=e.StorageUtils.nameSpaceKeyFilter(o,this.namespace);return localStorage.getItem(r[t])},t.prototype.getItem=function(e){return this.forcePromises?this.promisefy(this._getItem,arguments):this._getItem(e)},t.prototype._getItem=function(e){return localStorage.getItem(this.namespace+e)},t.prototype.setItem=function(e,t){return this.forcePromises?this.promisefy(this._setItem,arguments):this._setItem(e,t)},t.prototype._setItem=function(e,t){return localStorage.setItem(this.namespace+e,t)},t.prototype.removeItem=function(e){return this.forcePromises?this.promisefy(this._removeItem,arguments):this._removeItem(e)},t.prototype._removeItem=function(e){return localStorage.removeItem(this.namespace+e)},t.prototype.clear=function(){return this.forcePromises?this.promisefy(this._clear,arguments):this._clear()},t.prototype._clear=function(){for(var t=Object.keys(localStorage),o=e.StorageUtils.nameSpaceKeyFilter(t,this.namespace),r=0;r<o.length;r++)localStorage.removeItem(o[r])},t.prototype.setNamespace=function(e){return this.forcePromises?this.promisefy(this._setNameSpace,arguments):this._setNameSpace(e)},t.prototype._setNameSpace=function(e){e&&(this.namespace=e+":")},t.prototype.promisefy=function(e,t){var o=this;return new Promise(function(r,n){r(e.apply(o,t))})},t}(),t.LocalStorage=o}(PhaserSuperStorage||(PhaserSuperStorage={})),function(e){var t=function(){function t(o){if(void 0!==o)Object.defineProperty(o,"storage",{value:this});else{if(null!==t.instance)return t.instance;t.instance=this}e.StorageUtils.isLocalStorageSupport()?this.setAdapter(new e.StorageAdapters.LocalStorage):this.setAdapter(new e.StorageAdapters.CookieStorage)}return t.prototype.setAdapter=function(e){this.storage=e},Object.defineProperty(t.prototype,"forcePromises",{get:function(){return this.storage.forcePromises},set:function(e){this.storage.forcePromises=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return null===this.storage?0:this.storage.length},enumerable:!0,configurable:!0}),t.prototype.setNamespace=function(e){if(null!==this.storage)return this.storage.setNamespace(e)},t.prototype.key=function(e){return null===this.storage?"":this.storage.key(e)},t.prototype.getItem=function(e){return null===this.storage?null:this.storage.getItem(e)},t.prototype.setItem=function(e,t){if(null!==this.storage)return this.storage.setItem(e,t)},t.prototype.removeItem=function(e){if(null!==this.storage)return this.storage.removeItem(e)},t.prototype.clear=function(){if(null!==this.storage)return this.storage.clear()},t.instance=null,t}();e.StoragePlugin=t}(PhaserSuperStorage||(PhaserSuperStorage={})),void 0!==window.Phaser&&Phaser.Utils.mixinPrototype(PhaserSuperStorage.StoragePlugin,Phaser.Plugin),function(e){!function(e){e[e.init=0]="init",e[e.setItem=1]="setItem",e[e.getItem=2]="getItem",e[e.removeItem=3]="removeItem",e[e.clear=4]="clear",e[e.setNamespace=5]="setNamespace",e[e.length=6]="length",e[e.key=7]="key",e[e.error=8]="error"}(e.StorageCommand||(e.StorageCommand={}));var t=(e.StorageCommand,function(){function e(){}return e.isLocalStorageSupport=function(){try{if("object"==typeof localStorage)return localStorage.setItem("testingLocalStorage","foo"),localStorage.removeItem("testingLocalStorage"),!0}catch(e){return!1}return!1},e.validateMessage=function(e){return e.hasOwnProperty("command")?e:null},e.nameSpaceKeyFilter=function(e,t){return e.filter(function(e){return e.substring(0,t.length)===t})},e}());e.StorageUtils=t}(PhaserSuperStorage||(PhaserSuperStorage={}));