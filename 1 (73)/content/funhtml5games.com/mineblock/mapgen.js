var LOGNX=4,LOGNY=5,LOGNZ=4,NX=1<<LOGNX,NY=1<<LOGNY,NZ=1<<LOGNZ,CHUNK_RADIUS=Math.sqrt(NX*NX+NZ*NZ),SY=1,HY=NY*SY,LIGHT_SUN=6,GRASSY=!1,BLOCK_TYPES={air:{tile:0,empty:!0,opaque:!1},rock:{tile:1,solid:!0,opaque:!0},"ruby ore":{tile:[6,3],solid:!0,opaque:!0,drop:"ruby"},dirt:{tile:1,color:[233/255,107/255,0],solid:!0,opaque:!0,plantable:!0},grass:{tile:[1,1],color:[.1,.6,0],solid:!0,opaque:!0,plantable:!0,update:function(){this.neighbor(FACE_TOP).type.opaque&&this.placeBlock(BLOCK_TYPES.dirt)}},flag:{tile:4,
solid:!0,opaque:!0,stack:1},testpattern:{tile:5,solid:!0,opaque:!0},bedrock:{tile:6,solid:!0,opaque:!0},ice:{tile:7,solid:!0,translucent:[36,205,205,.5]},flower:{tile:8,hashes:1,scale:.6,upon:"plantable"},grassy:{tile:[4,2],hashes:2,height:.5},soybeans:{tile:[7,2],hashes:2,upon:"plantable",drop:"soybean"},weeds:{tile:[11,2],hashes:3,upon:"plantable",onstep:function(a){a.type===ENTITY_TYPES.player&&(!this.lastSpawn||this.lastSpawn+60<GAME.clock)&&(new Entity({type:"chumpa",x:this.x+1-frac(a.x),y:this.y,
z:this.z+1-frac(a.z)}),this.lastSpawn=GAME.clock)}},lamp:{tile:9,hashes:1,luminosity:[8,2,2],scale:.6,upon:"solid"},candy:{tile:10,solid:!0,opaque:!0},"grape jelly":{tile:14,liquid:!0,translucent:[154,40,155,.85],viscosity:.85},"strawberry jelly":{tile:13,liquid:!0,translucent:[200,81,83,.85],viscosity:.85},"apricot jelly":{tile:15,liquid:!0,translucent:[191,124,66,.85],viscosity:.85},water:{tile:[6,2],liquid:!0,translucent:[30,137,157,.5],viscosity:.5,unpickable:!0},"miso soup":{tile:[10,2],liquid:!0,
translucent:[174,154,112,.85],viscosity:.5,unpickable:!0},rope:{tile:[1,2],liquid:!0,hashes:1,update:function(){this.tile=[this.neighbor(FACE_BOTTOM).type===this.type?0:1,2];var a=this.neighbor(FACE_TOP).type;a.solid||a===this.type||this.breakBlock()},afterPlacement:function(){var a=this.neighbor(FACE_BOTTOM),b=a.neighbor(FACE_BOTTOM);!b.outofbounds&&a.type.empty&&b.type.empty&&a.placeBlock(this.type)}},mystery:{tile:[2,2,2,1],opaque:!0,solid:!0,stack:1},obelisk:{tile:[5,1],stack:2,solid:!0,opaque:!0},
log:{tile:[4,3,4,4],solid:!0,geometry:"log"},frond:{tile:[5,3],geometry:"frond"}},i;for(i in BLOCK_TYPES)BLOCK_TYPES[i].name=i;function generateBlock(a,b,c,h){var g;c<.75+2*noise(23.2*b,938.2*c,28.1*h)?g="bedrock":(g=pinkNoise(b,c,h+a,32,2)+(2*c/SY-NY)/NY,g=-.2>g?"rock":-.1>g?"dirt":0>g?GRASSY?"dirt":"grass":c<HY/4?"apricot jelly":c<HY/2?"water":"air",-.2>Math.pow(noise(b/20+a,c/20,h/20+1E3),3)&&(g="candy"),-.1>Math.pow(noise(b/20,c/20+a,h/20),3)&&(g="air"));return g}
function generateChunk(a,b,c){function h(a,b,c){return l[a+(b<<LOGNX)+(c<<LOGNX+LOGNY)]}function g(a,b){for(var c=NY-1;0<=c;--c){var d=h(a,c,b);if("air"!==d.type)return{iy:c,b:d}}}function m(a,c,b){for(b=b||0;a--;){var d=b+irand(NX-2*b),f=b+irand(NZ-2*b),e=g(d,f);e&&e.iy<NY-1&&BLOCK_TYPES[e.b.type].plantable&&(e=h(d,e.iy+1,f),e.type=c)}}for(var n={key:b+","+c,chunkx:b,chunkz:c,blocks:Array(NX*NY*NZ),entities:{}},l=n.blocks,d=0,k=0;k<NZ;++k)for(var e=0;e<NY;++e)for(var f=0;f<NX;++f)l[d++]={light:[0,
0,0,0],dirtyLight:!1,dirtyGeometry:!1,type:generateBlock(a,f+b,e*SY,k+c)};k=BLOCK_TYPES.soybeans.upon;for(f=0;f<NX;++f)for(a=f+b,d=0;d<NZ;++d)e=d+c,-.5>2*noise(a/10,9938,e/10)+noise(a/1,9938,e/1)&&(e=g(f,d))&&e.iy<NY-1&&BLOCK_TYPES[e.b.type][k]&&(h(f,e.iy+1,d).type="soybeans");m(4,"flower");m(6,"weeds");for(f=0;f<NX;++f)for(k=0;k<NZ;++k)for(b=!1,c=NY-1;0<=c;--c)a=h(f,c,k),d=BLOCK_TYPES[a.type],a.light[3]=d.opaque?0:b?0:LIGHT_SUN,a.dirtyLight=!1,d.luminosity&&(a.dirtyLight=!0),b&&!d.opaque&&(a.dirtyLight=
!0),b=b||d.opaque||d.translucent;return n}function irand(a){return Math.floor(Math.random()*a)}"undefined"!==typeof importScripts&&(importScripts("perlin.js"),self.onmessage=function(a){a=generateChunk(a.data.seed,a.data.chunkx,a.data.chunkz);postMessage(a)});